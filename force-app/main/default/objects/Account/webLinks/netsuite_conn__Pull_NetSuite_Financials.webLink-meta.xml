<?xml version="1.0" encoding="UTF-8"?>
<WebLink xmlns="http://soap.sforce.com/2006/04/metadata">
    <fullName>netsuite_conn__Pull_NetSuite_Financials</fullName>
    <availability>online</availability>
    <displayType>button</displayType>
    <linkType>javascript</linkType>
    <masterLabel>Pull NetSuite Financials</masterLabel>
    <openType>onClickJavaScript</openType>
    <protected>false</protected>
    <url>var Celigo = {};
Celigo.SFDC = (function() {
  var getCustomerFinancials = function() {
	this.triggerSync = function() {						
		try{
			var top = screen.height - (screen.height * .7) - 80,
            	left = screen.width - (screen.width * .65) - 87;
			var params = &apos;dependent = yes,resizable=false,scrollbars=false,toolbar=false,menubar=false,location=false,status=true,directories=false,width=575,height=200&apos;;
			params+=&apos;,top=&apos;+top.toString()+&apos; ,left=&apos;+left.toString()+ &apos;\&apos;&apos;;
					
			var nsCustomerId  = &apos;{!Account.netsuite_conn__NetSuite_Id__c}&apos;;				
			if(!nsCustomerId){
				alert(&apos;No Netsuite Customer associated with this account. Cannot fetch Financial Information.&apos;);
				return;
			}
			
			var popup_window = window.open(&apos;/apex/netsuite_conn__PullCustomerFinancials?id=&apos;+&apos;{!Account.Id}&apos;+&apos;&amp;nsId=&apos;+nsCustomerId, &apos;NetSuite_Synchronization&apos;, params);
			//wait for 60 seconds or till window is closed.
			var waitcount =0;
			window.setInterval(function(){	
				if(waitcount&gt;=60 || popup_window.closed){
					window.clearInterval();
					window.location.reload();
				}
				waitcount++;
			},1000);

		}catch(e){
			console.log(&apos;The error details:&apos;+e.message);
		}

		};
	};

	return {
		main: function() {
			Celigo.getCustomerFinancials = new getCustomerFinancials();
			Celigo.getCustomerFinancials.triggerSync();
	}
	
	};
})();
Celigo.SFDC.main();</url>
</WebLink>
